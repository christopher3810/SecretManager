다음은 Vault, Redis, PostgreSQL, JWT 토큰 및 새로 고침 토큰을 통합한 사용자 가입 및 로그인 프로세스에 대한 단계별 설명입니다:

사용자 가입:
a. 사용자가 등록 세부 정보(이메일, 비밀번호 등)를 가입 엔드포인트에 제출합니다.
b. 서버는 이메일이 유효한 형식인지, 비밀번호가 복잡성 요건을 충족하는지 확인하는 등 제공된 정보의 유효성을 검사합니다.
c. 서버는 비밀번호를 해시하고 사용자 정보를 PostgreSQL 데이터베이스에 저장합니다.
d. 서버는 이메일 확인 토큰을 생성하고 만료 시간과 함께 Redis에 저장합니다.
e. 서버는 확인 토큰이 포함된 링크가 포함된 확인 이메일을 사용자에게 보냅니다.
f. 사용자가 확인 링크를 클릭하면 서버가 토큰 유효성 검사 요청을 서버에 보냅니다.
g. 서버는 Redis에서 토큰을 확인하고 유효한 경우 사용자의 이메일을 확인하고 사용자 계정을 활성으로 표시합니다.

사용자 로그인:
a. 사용자가 로그인 엔드포인트에 이메일과 비밀번호를 제출합니다.
b. 서버가 제출된 이메일과 비밀번호를 PostgreSQL 데이터베이스와 비교하여 확인합니다.
c. 이메일과 비밀번호가 정확하면 서버가 JWT 액세스 토큰과 새로 고침 토큰을 생성합니다.
d. 서버는 액세스 토큰과 새로 고침 토큰에 서명하기 위해 Vault에서 JWT 비밀과 만료 시간을 검색합니다.
e. 서버가 액세스 토큰과 새로 고침 토큰을 사용자에게 보냅니다.

URL A와 URL B에 액세스하기:
a. 사용자가 권한 부여 헤더에 JWT 액세스 토큰을 포함하여 URL A에 액세스하라는 요청을 보냅니다.
b. 서버가 액세스 토큰의 유효성을 검사하여 서명과 만료 시간을 확인합니다.
c. 토큰이 유효하면 서버는 요청을 처리하고 URL A에 대한 적절한 응답을 반환합니다.
d. 사용자는 권한 부여 헤더에 JWT 액세스 토큰을 포함하여 URL B에 대한 액세스 요청을 보냅니다.
e. 서버가 액세스 토큰의 유효성을 검사하여 서명과 만료 시간을 확인합니다.
f. 토큰이 유효하면 서버가 요청을 처리하고 URL B에 대한 적절한 응답을 반환합니다.

액세스 토큰 새로 고침:
a. JWT 액세스 토큰이 만료되면 사용자는 새로 고침 토큰을 포함하여 새로 고침 토큰 엔드포인트에 요청을 보냅니다.
b. 서버가 새로 고침 토큰의 유효성을 검사하여 서명 및 만료 시간을 확인합니다.
c. 새로 고침 토큰이 유효하면 서버는 새 JWT 액세스 토큰을 생성하여 사용자에게 보냅니다.
d. 이제 사용자는 새 액세스 토큰을 사용하여 필요에 따라 URL A 및 URL B에 액세스할 수 있습니다.

이 흐름은 인증되고 권한이 부여된 사용자만 JWT 액세스 토큰을 사용하여 보호된 리소스(URL A 및 URL B)에 액세스할 수 있도록 합니다. 토큰 새로 고침 메커니즘을 통해 사용자는 재인증 없이 새 액세스 토큰을 얻을 수 있으므로 더 나은 사용자 환경과 향상된 보안을 제공합니다.
